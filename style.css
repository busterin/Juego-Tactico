:root{
  --cell: 48px;
  --cols: 16;
  --rows: 9;
  --npRows: 2;
  --bg-url: url("assets/background.PNG"); /* importante: .PNG */
}

body{
  margin:0;
  background:#000;
  font-family: system-ui, sans-serif;
  overflow:hidden;
  touch-action: manipulation;
}

/* --- Portada --- */
#portada{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:10000;
}
.portada-img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.portada-actions{
  position:absolute;
  bottom:10%;
  display:flex;
  gap:12px;
  z-index:10010;
}
.btn{
  padding:12px 20px;
  border-radius:10px;
  border:none;
  font-weight:700;
  font-size:15px;
  cursor:pointer;
  background:#2c7;
  color:#fff;
}
.btn.secondary{
  background:#555;
}

/* --- Intro --- */
#introScene{
  position:fixed;
  inset:0;
  background:#000;
  z-index:11000;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  align-items:center;
}
.intro-bg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}
.intro-box{
  position:relative;
  background:rgba(0,0,0,.85);
  color:#fff;
  padding:18px;
  width:90%;
  margin-bottom:6%;
  border-radius:10px;
  z-index:2;
}
.intro-text{ font-size:15px; line-height:1.4; }
.intro-cta{ text-align:right; margin-top:10px; }

/* --- Diálogo --- */
#dialogScene{
  position:fixed;
  inset:0;
  z-index:12000;
  display:none;
}
#dialogScene .dialog-bg{
  position:absolute;
  inset:0;
  background-image: var(--bg-url);
  background-size:cover;
  background-position:center;
}
.dialog-char{
  position:absolute;
  bottom:8%; /* más abajo */
  height:56%;
  max-width:44vw;
  object-fit:contain;
  image-rendering:pixelated;
  opacity:.9;
}
.dialog-char.left{ left:2%; }
.dialog-char.right{ right:2%; }
.dialog-char.right.stack2{ right:20%; }
.dialog-char.left.stack2{ left:20%; }
.dialog-char.flip{ transform:scaleX(-1); }
.dialog-box{
  position:absolute;
  left:4%;
  right:4%;
  bottom:3%;
  background:rgba(7,12,16,1);
  border:1px solid rgba(255,255,255,.14);
  border-radius:12px;
  padding:10px 12px;
  z-index:12100;
  color:#fff;
}
.dialog-name{ font-weight:800; margin-bottom:6px; }
.dialog-text{ font-size:14px; line-height:1.35; min-height:3em; margin-bottom:10px; }
.dialog-cta{ text-align:right; }

/* --- Mapa --- */
#mapa{
  display:grid;
  grid-template-columns: repeat(var(--cols), var(--cell));
  grid-template-rows: repeat(var(--rows), var(--cell));
  background-image: var(--bg-url);
  background-size:cover;
  background-position:center;
  position:relative;
  margin:0 auto;
}
.celda{
  position:relative;
  width:var(--cell);
  height:var(--cell);
  box-sizing:border-box;
}
.celda.movible{ background:rgba(0,200,255,.2); }
.celda.seleccionada{ outline:2px solid yellow; }
.fichaMiniImg{ width:100%; height:100%; object-fit:contain; image-rendering:pixelated; }

/* --- HUD --- */
#hud{
  position:absolute;
  left:0; right:0; bottom:0;
  display:flex;
  justify-content:space-between;
  padding:6px;
  background:rgba(0,0,0,.55);
}
#ficha, #acciones{ flex:1; color:#fff; }

/* --- Overlays --- */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:grid;
  place-items:center;
  z-index:15000;
}
.overlay-box{ background:#111; padding:20px; border-radius:12px; color:#fff; text-align:center; }

/* Turn banner */
.turn-banner{
  position:fixed;
  top:15%;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.7);
  color:#fff;
  padding:10px 20px;
  border-radius:12px;
  font-weight:700;
  z-index:15000;
}

/* --- Botón Guardar: fijo arriba-derecha --- */
#btnGuardar{
  position:fixed;
  right:max(10px, env(safe-area-inset-right));
  top:max(10px, env(safe-area-inset-top));
  z-index:19500;
  padding:10px 14px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(0,0,0,.6);
  color:#fff;
  font-weight:800;
  cursor:pointer;
  backdrop-filter:blur(3px);
}
#btnGuardar:hover{ background:rgba(0,0,0,.75); }

/* --- Rejilla debug (tecla G) --- */
.celda .grid-label{
  display:none;
  position:absolute;
  left:2px; top:2px;
  font-size:10px;
  color:rgba(255,255,255,.8);
  text-shadow:0 1px 2px rgba(0,0,0,.6);
  pointer-events:none;
}
#mapa.debug .grid-label{ display:block; }
#mapa.debug .celda{
  outline:1px dashed rgba(255,255,255,.18);
  outline-offset:-1px;
}